trigger:
  branches:
    include:
    - master
  paths:
    include:
    - images/linux/**
    exclude:
    - /**

pr: none

schedules:
- cron: "0 0 1 * *"
  displayName: Monthly Image Build
  branches:
    include:
    - master

resources:
  repositories:
    - repository: templates
      type: github
      name: hmcts/azure-devops-templates
      ref: refs/heads/master
      endpoint: hmcts

pool:
  vmImage: 'ubuntu-latest'

##############################
# Variables. #################
variables:
  - name: serviceConnection
    value: GlobalNetworkPeering

############################################
# Packer Build. ############################
stages:
- stage: PackerBuild
  displayName: Packer Build
  jobs:
  - job: PackerBuild
    displayName: Packer Build
    steps:
      - template: /build/templates/packer-build.yml
        parameters:
          serviceConnection: $(serviceConnection)
          packerConfigFile: images/linux/ubuntu2204.pkr.hcl
          imageDefinition: devops-ubuntu
          sharedImagePrefix: azure-devops-agent